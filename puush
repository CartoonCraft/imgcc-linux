#!/bin/sh

#PUUSH_API_KEY="apikeyhere"

if [ "$1" = "-" ]
then
    if [ "$2" != "" ]
    then
        EXT=$2
    else
        EXT="txt"
    fi
    _IFS=$IFS
    IFS='' # to preserve spacing
    while read p
    do
        echo $p >> /tmp/puush-tmp.$EXT
    done
    IFS=_IFS
    FN="/tmp/puush-tmp.$EXT"
else
    FN="$1"
fi

if [ -z "$PUUSH_API_KEY" ]
then
    echo "Set the variable PUUSH_API_KEY in $0 or with 'export PUUSH_API_KEY=\"apiKeyHere\""
    exit 1
elif [ -z "$FN" ]
then
    echo "Specify a file to be uploaded"
    exit 2
elif ! [ -f "$FN" -a -r "$FN" ]
then
    echo "File '$FN' is not valid (it is not a file or it is not readable)"
    exit 3
fi

curl "https://puush.me/api/up" -# -F "k=$PUUSH_API_KEY" -F "z=poop" -F "f=@$FN" | sed -E 's/^.+,(.+),.+,.+$/\1\n/'
rm /tmp/puush-tmp.* 2>/dev/null
